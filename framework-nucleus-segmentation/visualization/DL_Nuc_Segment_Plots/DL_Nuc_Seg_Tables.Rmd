---
title: "Tables for the DL Nuclear Segmentation Manuscript"
date: "Jun 15 2020"
authors: "Gianluca Pegoraro/George Zaki, NCI/NIH"
output: github_document
---

Load the required libraries
```{r}
library(tidyverse)
library(readr)
library(knitr)
library(kableExtra)
```

Set `knitr` options.
```{r}
knitr::opts_chunk$set(
    cache = FALSE,
    fig.path = "Output/",
    dev = c("png", "pdf"),
    message = FALSE,
    warning = FALSE
    )
```

Read the `.csv` tables generated by the `DL_Nuc_Seg_Results.Rmd` analysis script.
```{r}
table_1 <- read_csv("Output/Table1.csv")
table_2 <- read_csv("Output/Table2.csv")
table_S1 <- read_csv("Output/TableS1.csv")
```

Rearrange the Table 1 to have cell lines and F1 thresholds as columns and models and GT labels annotation strategies as rows.
```{r table1Reformat}
table_1_reformat <- table_1 %>%
    rename(`MRCNN_0.7` = `MRCNN-0.7`,
           `MRCNN_0.9` = `MRCNN-0.9`,
           `FPN2-WS_0.7` = `FPN2-WS-0.7`,
           `FPN2-WS_0.9` = `FPN2-WS-0.9`) %>%
    pivot_longer(cols = -`Cell Line`,
                 names_sep = "_",
                 names_to = c("Model", "Threshold"),
                 values_to = "F1 Score") %>%
    pivot_wider(names_from = c(`Cell Line`, `Threshold`),
                values_from = `F1 Score`,
                names_sep = "/") %>%
    arrange(Model)
```

Same as above, but for Table 2.
```{r table2Reformat}
table_2_reformat <- table_2 %>%
    rename(`MRCNN_0.7` = `MRCNN-0.7`,
           `MRCNN_0.9` = `MRCNN-0.9`,
           `FPN2-WS_0.7` = `FPN2-WS-0.7`,
           `FPN2-WS_0.9` = `FPN2-WS-0.9`,
           Jacobkie_0.7 = `Jacobkie-0.7`,
           Jacobkie_0.9 = `Jacobkie-0.9`,
           ) %>%
    pivot_longer(cols = -`Cell Line`,
                 names_sep = "_",
                 names_to = c("Model", "Threshold"),
                 values_to = "F1 Score") %>%
    pivot_wider(names_from = c(`Cell Line`, `Threshold`),
                values_from = `F1 Score`,
                names_sep = "/")
```

Same as above, but for Table S1.
```{r tableS1 Reformat}
table_S1_reformat <- table_S1 %>%
    rename(`MRCNN/Manual_0.7` = `MRCNN-Manual-0.7`,
           `MRCNN/SemiAutomated_0.7` = `MRCNN-Semi-Automated-0.7`,
           `MRCNN/Manual_0.9` = `MRCNN-Manual-0.9`,
           `MRCNN/SemiAutomated_0.9` = `MRCNN-Semi-Automated-0.9`,
           `FPN2-WS/Manual_0.7` = `FPN2-WS-Manual-0.7`,
           `FPN2-WS/SemiAutomated_0.7` = `FPN2-WS-Semi-Automated-0.7`,
           `FPN2-WS/Manual_0.9` = `FPN2-WS-Manual-0.9`,
           `FPN2-WS/SemiAutomated_0.9` = `FPN2-WS-Semi-Automated-0.9`,
           `Jacobkie/Manual_0.7` = `Jacobkie-Manual-0.7`,
           `Jacobkie/SemiAutomated_0.7` = `Jacobkie-Semi-Automated-0.7`,
           `Jacobkie/Manual_0.9` = `Jacobkie-Manual-0.9`,
           `Jacobkie/SemiAutomated_0.9` = `Jacobkie-Semi-Automated-0.9`,
           ) %>%
    pivot_longer(cols = -`Cell Line`,
                 names_sep = "_",
                 names_to = c("Model", "Threshold"),
                 values_to = "F1 Score") %>%
    separate(col = Model,
             into = c("Model", "GT Annotation"),
             sep = "/") %>%
    pivot_wider(names_from = c(`Cell Line`, `Threshold`),
                values_from = `F1 Score`,
                names_sep = "/")
```

Generate Table 1. The table is saved as a .pdf file. 
```{r}
table_1_reformat %>%
    # This part is to label in bold the maximum values for any
    # combination of cell line and threshold
    mutate(`MCF10A/0.7` = cell_spec(round(`MCF10A/0.7`, 2), 
                                    "latex", 
                                     bold = `MCF10A/0.7` == max(`MCF10A/0.7`)),
           `MCF10A/0.9` = cell_spec(round(`MCF10A/0.9`, 2), 
                                    "latex", 
                                     bold = `MCF10A/0.9` == max(`MCF10A/0.9`)),
           `U2OS/0.7` = cell_spec(round(`U2OS/0.7`, 2), 
                                    "latex", 
                                     bold = `U2OS/0.7` == max(`U2OS/0.7`)),
           `U2OS/0.9` = cell_spec(round(`U2OS/0.9`, 2), 
                                    "latex", 
                                     bold = `U2OS/0.9` == max(`U2OS/0.9`)),
           `HCT116/0.7` = cell_spec(round(`HCT116/0.7`, 2), 
                                    "latex", 
                                     bold = `HCT116/0.7` == max(`HCT116/0.7`)),
           `HCT116/0.9` = cell_spec(round(`HCT116/0.9`, 2), 
                                    "latex", 
                                     bold = `HCT116/0.9` == max(`HCT116/0.9`)),
           `Eosinophils/0.7` = cell_spec(round(`Eosinophils/0.7`, 2), 
                                    "latex", 
                                     bold = `Eosinophils/0.7` == max(`Eosinophils/0.7`)),
           `Eosinophils/0.9` = cell_spec(round(`Eosinophils/0.9`, 2), 
                                    "latex", 
                                     bold = `Eosinophils/0.9` == max(`Eosinophils/0.9`))
           ) %>%
kable(format = "latex",
      escape = F,
      booktabs = T,
      align = "c") %>%
   kable_styling(latex_options = "scale_down") %>%
   landscape() %>%
   save_kable("Output/Table_1.pdf")
```

Same, but for Table 2.
```{r}
table_2_reformat %>%
    mutate(`MCF10A/0.7` = cell_spec(round(`MCF10A/0.7`, 2), 
                                    "latex", 
                                     bold = `MCF10A/0.7` == max(`MCF10A/0.7`)),
           `MCF10A/0.9` = cell_spec(round(`MCF10A/0.9`, 2), 
                                    "latex", 
                                     bold = `MCF10A/0.9` == max(`MCF10A/0.9`)),
           `U2OS/0.7` = cell_spec(round(`U2OS/0.7`, 2), 
                                    "latex", 
                                     bold = `U2OS/0.7` == max(`U2OS/0.7`)),
           `U2OS/0.9` = cell_spec(round(`U2OS/0.9`, 2), 
                                    "latex", 
                                     bold = `U2OS/0.9` == max(`U2OS/0.9`)),
           `HCT116/0.7` = cell_spec(round(`HCT116/0.7`, 2), 
                                    "latex", 
                                     bold = `HCT116/0.7` == max(`HCT116/0.7`)),
           `HCT116/0.9` = cell_spec(round(`HCT116/0.9`, 2), 
                                    "latex", 
                                     bold = `HCT116/0.9` == max(`HCT116/0.9`)),
           `Eosinophils/0.7` = cell_spec(round(`Eosinophils/0.7`, 2), 
                                    "latex", 
                                     bold = `Eosinophils/0.7` == max(`Eosinophils/0.7`)),
           `Eosinophils/0.9` = cell_spec(round(`Eosinophils/0.9`, 2), 
                                    "latex", 
                                     bold = `Eosinophils/0.9` == max(`Eosinophils/0.9`))
           ) %>%
kable(format = "latex",
      escape = F,
      booktabs = T,
      align = "c") %>%
   kable_styling(latex_options = "scale_down") %>%
   landscape() %>% 
   save_kable("Output/Table_2.pdf")
```

Same but for Table S1.
```{r}
table_S1_reformat %>%
    mutate(`MCF10A/0.7` = cell_spec(round(`MCF10A/0.7`, 2), 
                                    "latex", 
                                     bold = `MCF10A/0.7` == max(`MCF10A/0.7`)),
           `MCF10A/0.9` = cell_spec(round(`MCF10A/0.9`, 2), 
                                    "latex", 
                                     bold = `MCF10A/0.9` == max(`MCF10A/0.9`)),
           `U2OS/0.7` = cell_spec(round(`U2OS/0.7`, 2), 
                                    "latex", 
                                     bold = `U2OS/0.7` == max(`U2OS/0.7`)),
           `U2OS/0.9` = cell_spec(round(`U2OS/0.9`, 2), 
                                    "latex", 
                                     bold = `U2OS/0.9` == max(`U2OS/0.9`)),
           `HCT116/0.7` = cell_spec(round(`HCT116/0.7`, 2), 
                                    "latex", 
                                     bold = `HCT116/0.7` == max(`HCT116/0.7`)),
           `HCT116/0.9` = cell_spec(round(`HCT116/0.9`, 2), 
                                    "latex", 
                                     bold = `HCT116/0.9` == max(`HCT116/0.9`)),
           `Eosinophils/0.7` = cell_spec(round(`Eosinophils/0.7`, 2), 
                                    "latex", 
                                     bold = `Eosinophils/0.7` == max(`Eosinophils/0.7`)),
           `Eosinophils/0.9` = cell_spec(round(`Eosinophils/0.9`, 2), 
                                    "latex", 
                                     bold = `Eosinophils/0.9` == max(`Eosinophils/0.9`))
           ) %>%
kable(format = "latex",
      escape = F,
      booktabs = T,
      align = "c") %>%
   kable_styling(latex_options = "scale_down") %>%
   landscape() %>%
   save_kable("Output/Table_S1.pdf")
```

```{r sessionInfo, results='markup'}
sessionInfo()
```